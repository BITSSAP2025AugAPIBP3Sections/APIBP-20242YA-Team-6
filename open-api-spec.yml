openapi: 3.1.0
info:
  title: Event Management API
  version: 1.3.0
  description: |
    RESTful API for the Event Management MVP covering Authentication, Events, Vendors, Tasks, Notifications, and Attendees.
    Supports JWT-based authentication and modular microservice structure.
    
    **Version 1.3.0 Changes:**
    - Restructured RSVP endpoints for better RESTful design
    - RSVP endpoints now use query parameters: POST/PUT /events/{eventId}/rsvps?status=going
    - User's RSVP list moved from /attendees to /rsvps for clarity
    - Removed request body from RSVP endpoints in favor of query parameters
    
    **Version 1.2.0 Changes:**
    - Vendors are now global entities (removed eventId from vendor schemas)
    - Tasks can only be created via POST /events/{eventId}/tasks

servers:
  - url: http://localhost:8000/v1
    description: Local development server
  - url: https://event-management-api.c-8c5e74f.kyma.ondemand.com/v1
    description: Production server

tags:
  - name: Auth
  - name: Events
  - name: Vendors
  - name: Tasks
  - name: Notifications
  - name: Attendees

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum: [admin, organizer, vendor, attendee]

    Event:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        location:
          type: string
        startAt:
          type: string
          format: date-time
        endAt:
          type: string
          format: date-time
        organizerId:
          type: string

    CreateEvent:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        location:
          type: string
        startAt:
          type: string
          format: date-time
        endAt:
          type: string
          format: date-time

    Vendor:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
          nullable: true
      description: Vendor entity - global catalog not tied to specific events
    
    VendorCreate:
      type: object
      required: [name, email]
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
          nullable: true
      description: Create a vendor in the global vendor catalog
    
    VendorUpdate:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
          nullable: true
      description: Update vendor information
    
    PaginatedVendorResponse:
      type: object
      properties:
        vendors:
          type: array
          items:
            type: object
        pagination:
          type: object
          properties:
            current_page:
              type: integer
            page_size:
              type: integer
            total_count:
              type: integer
            total_pages:
              type: integer
            has_next:
              type: boolean
            has_previous:
              type: boolean
            next_page:
              type: integer
              nullable: true
            previous_page:
              type: integer
              nullable: true
        filters:
          type: object
          nullable: true
        sorting:
          type: object
          properties:
            sort_by:
              type: string
            sort_order:
              type: string

    Task:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [pending, in_progress, completed]
        eventId:
          type: string
        vendorId:
          type: string
          nullable: true
        organizerId:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TaskPaginationResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Task"
        pagination:
          $ref: "#/components/schemas/PaginationInfo"

    CreateEventTask:
      type: object
      required: [title]
      properties:
        title:
          type: string
          description: Task title
        description:
          type: string
          description: Task description
        status:
          type: string
          enum: [pending, in_progress, completed]
          default: pending
          description: Task status
        vendorId:
          type: string
          nullable: true
          description: ID of vendor assigned to this task

    PaginationInfo:
      type: object
      properties:
        current_page:
          type: integer
        page_size:
          type: integer
        total_count:
          type: integer
        total_pages:
          type: integer
        has_next:
          type: boolean
        has_previous:
          type: boolean
        next_page:
          type: integer
          nullable: true
        previous_page:
          type: integer
          nullable: true

    Notification:
      type: object
      properties:
        id:
          type: string
        recipientId:
          type: string
        type:
          type: string
        message:
          type: string
        createdAt:
          type: string
          format: date-time

    Attendee:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        eventId:
          type: string
        status:
          type: string
          enum: [invited, going, interested, not_going]
        rsvpAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateRsvp:
      type: object
      required: [status]
      properties:
        status:
          type: string
          enum: [going, interested, not_going]
          description: RSVP status for the event
    
    UpdateRsvp:
      type: object
      required: [status]
      properties:
        status:
          type: string
          enum: [going, interested, not_going]
          description: Updated RSVP status for the event
    
    PaginatedAttendeeResponse:
      type: object
      properties:
        attendees:
          type: array
          items:
            $ref: "#/components/schemas/Attendee"
        pagination:
          type: object
          properties:
            current_page:
              type: integer
            page_size:
              type: integer
            total_count:
              type: integer
            total_pages:
              type: integer
            has_next:
              type: boolean
            has_previous:
              type: boolean
            next_page:
              type: integer
              nullable: true
            previous_page:
              type: integer
              nullable: true
        filters:
          type: object
          nullable: true
        sorting:
          type: object
          properties:
            sort_by:
              type: string
            sort_order:
              type: string
    
    EventAttendeeResponse:
      type: object
      properties:
        event_id:
          type: string
        attendees:
          type: array
          items:
            $ref: "#/components/schemas/Attendee"
        pagination:
          type: object
          properties:
            current_page:
              type: integer
            page_size:
              type: integer
            total_count:
              type: integer
            total_pages:
              type: integer
            has_next:
              type: boolean
            has_previous:
              type: boolean
            next_page:
              type: integer
              nullable: true
            previous_page:
              type: integer
              nullable: true
        filters:
          type: object
          nullable: true
        sorting:
          type: object
          properties:
            sort_by:
              type: string
            sort_order:
              type: string

paths:

  ##############################
  # AUTH SERVICE
  ##############################
  /auth/login:
    post:
      tags: [Auth]
      summary: Login and get JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        "200":
          description: JWT token response
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
        "400":
          description: Bad request - Invalid email format or missing required fields
        "401":
          description: Unauthorized - Invalid credentials
        "422":
          description: Validation error - Request body validation failed
        "429":
          description: Too many requests - Rate limit exceeded
        "500":
          description: Internal server error

  /auth/register:
    post:
      tags: [Auth]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, role]
              properties:
                email:
                  type: string
                password:
                  type: string
                role:
                  type: string
                  enum: [admin, organizer, vendor, attendee]
      responses:
        "201":
          description: User registered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: Bad request - Invalid input data
        "409":
          description: Conflict - Email already exists
        "422":
          description: Validation error - Request body validation failed
        "429":
          description: Too many requests - Rate limit exceeded
        "500":
          description: Internal server error

  /auth/me:
    get:
      tags: [Auth]
      summary: Get current authenticated user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Authenticated user details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "500":
          description: Internal server error

  ##############################
  # EVENTS SERVICE
  ##############################
  /events:
    get:
      tags: [Events]
      summary: List all events with advanced filtering, sorting, and pagination
      description: |
        Retrieve a paginated list of events with support for:
        - **Pagination**: Use `page` and `page_size` parameters
        - **Sorting**: Use `sort_by` and `sort_order` parameters
        - **Filtering**: Filter by name, location, organizerId, or use global search
        - **Field Selection**: Use `fields` parameter to specify which fields to return
        
        **Role-based access:**
        - **Admins/Organizers**: Can view all events
        - **Vendors**: Can view events where they have assigned tasks (filtered automatically)
        - **Attendees**: Can view all events
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number (starts from 1)
        - name: page_size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of events per page (max 100)
        - name: sort_by
          in: query
          schema:
            type: string
            enum: [id, name, location, startAt, endAt, organizerId, createdAt]
            default: id
          description: Field to sort by
        - name: sort_order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: asc
          description: Sort order (ascending or descending)
        - name: fields
          in: query
          schema:
            type: string
          description: Comma-separated list of fields to return (e.g., "id,name,location")
          example: "id,name,startAt,location"
        - name: name
          in: query
          schema:
            type: string
          description: Filter by event name (partial match, case-insensitive)
        - name: location
          in: query
          schema:
            type: string
          description: Filter by event location (partial match, case-insensitive)
        - name: organizerId
          in: query
          schema:
            type: string
          description: Filter by organizer ID (exact match)
        - name: search
          in: query
          schema:
            type: string
          description: Global search across name, description, and location fields
      responses:
        "200":
          description: List of events with pagination metadata
          content:
            application/json:
              schema:
                type: object
                properties:
                  events:
                    type: array
                    items:
                      $ref: "#/components/schemas/Event"
                  pagination:
                    type: object
                    properties:
                      current_page:
                        type: integer
                        description: Current page number
                      page_size:
                        type: integer
                        description: Number of items per page
                      total_count:
                        type: integer
                        description: Total number of events matching filters
                      total_pages:
                        type: integer
                        description: Total number of pages
                      has_next:
                        type: boolean
                        description: Whether there are more pages
                      has_previous:
                        type: boolean
                        description: Whether there are previous pages
                      next_page:
                        type: integer
                        nullable: true
                        description: Next page number if available
                      previous_page:
                        type: integer
                        nullable: true
                        description: Previous page number if available
                  filters:
                    type: object
                    nullable: true
                    description: Applied filters
                    properties:
                      name:
                        type: string
                      location:
                        type: string
                      organizerId:
                        type: string
                      search:
                        type: string
                  sorting:
                    type: object
                    description: Applied sorting
                    properties:
                      sort_by:
                        type: string
                      sort_order:
                        type: string
              examples:
                paginatedEvents:
                  summary: Example paginated events response
                  value:
                    events:
                      - id: "1"
                        name: "Tech Conference 2025"
                        description: "Annual technology conference"
                        location: "San Francisco"
                        startAt: "2025-03-15T09:00:00Z"
                        endAt: "2025-03-17T18:00:00Z"
                        organizerId: "123"
                      - id: "2"
                        name: "Music Festival"
                        description: "Summer music festival"
                        location: "Los Angeles"
                        startAt: "2025-06-20T12:00:00Z"
                        endAt: "2025-06-22T23:00:00Z"
                        organizerId: "124"
                    pagination:
                      current_page: 1
                      page_size: 10
                      total_count: 25
                      total_pages: 3
                      has_next: true
                      has_previous: false
                      next_page: 2
                      previous_page: null
                    filters:
                      location: "San"
                    sorting:
                      sort_by: "startAt"
                      sort_order: "asc"
        "400":
          description: Bad request - Invalid query parameters
        "401":
          description: Unauthorized — JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "500":
          description: Internal server error
 
    post:
      tags: [Events]
      summary: Create a new event
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateEvent"
      responses:
        "201":
          description: Event created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Event"
        "400":
          description: Invalid request body or missing required fields
        "401":
          description: Unauthorized — JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "422":
          description: Validation error - Request body validation failed
        "500":
          description: Internal server error
 
  /events/{id}:
    get:
      tags: [Events]
      summary: Get single event by ID
      description: |
        Retrieve detailed information about a specific event.
        
        **Role-based access:**
        - **Admins/Organizers/Attendees**: Can view any event
        - **Vendors**: Can view events where they have assigned tasks
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Event found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Event"
        "401":
          description: Unauthorized — JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Event not found - Invalid event ID
        "500":
          description: Internal server error
    
    patch:
      tags: [Events]
      summary: Update event
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateEvent"
      responses:
        "200":
          description: Updated event
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Event"
        "400":
          description: Invalid request body or missing required fields
        "401":
          description: Unauthorized — JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Event not found - Invalid event ID
        "422":
          description: Validation error - Request body validation failed
        "500":
          description: Internal server error

 
    delete:
      tags: [Events]
      summary: Delete event
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Event deleted successfully
        "401":
          description: Unauthorized — JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Event not found - Invalid event ID
        "409":
          description: Conflict - Cannot delete event with existing dependencies
        "500":
          description: Internal server error

  /events/{eventId}/tasks:
    post:
      tags: [Events]
      summary: Create a task for a specific event
      description: |
        Creates a new task associated with the specified event.
        **Note:** This is the ONLY way to create tasks. Direct POST to /tasks has been removed.
      security:
        - bearerAuth: []
      parameters:
        - name: eventId
          in: path
          required: true
          schema:
            type: string
          description: ID of the event to create task for
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateEventTask"
            examples:
              withVendor:
                summary: Task with vendor assignment
                value:
                  title: "Setup sound system"
                  description: "Install and test audio equipment"
                  status: "pending"
                  vendorId: "123"
              withoutVendor:
                summary: Task without vendor
                value:
                  title: "Send invitations"
                  description: "Email all attendees"
                  status: "pending"
      responses:
        "201":
          description: Task created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        "400":
          description: Bad request - Invalid input data
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Only admins and organizers can create tasks
        "404":
          description: Event not found
        "500":
          description: Internal server error

    get:
      tags: [Events]
      summary: Get all tasks for a specific event
      description: Retrieve a paginated list of tasks associated with the specified event
      security:
        - bearerAuth: []
      parameters:
        - name: eventId
          in: path
          required: true
          schema:
            type: string
          description: ID of the event to get tasks for
      responses:
        "200":
          description: List of tasks for the event
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskPaginationResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Event not found
        "500":
          description: Internal server error

  ##############################
  # ATTENDEE SERVICE
  ##############################
  /rsvps:
    get:
      tags: [Attendees]
      summary: Get user's own RSVPs with advanced filtering, sorting, pagination, and field selection
      description: |
        Retrieve a paginated list of the current user's RSVPs with support for:
        - **Pagination**: Use `page` and `page_size` parameters
        - **Sorting**: Use `sort_by` and `sort_order` parameters  
        - **Filtering**: Filter by eventId or status
        - **Field Selection**: Use `fields` parameter to specify which fields to return
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number (starts from 1)
        - name: page_size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of attendees per page (max 100)
        - name: sort_by
          in: query
          schema:
            type: string
            enum: [id, eventId, status, rsvpAt, createdAt, updatedAt]
            default: id
          description: Field to sort by
        - name: sort_order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order (ascending or descending)
        - name: fields
          in: query
          schema:
            type: string
          description: Comma-separated list of fields to return (e.g., "id,eventId,status")
          example: "id,eventId,status,rsvpAt"
        - name: eventId
          in: query
          schema:
            type: string
          description: Filter by event ID (exact match)
        - name: status
          in: query
          schema:
            type: string
            enum: [invited, going, interested, not_going]
          description: Filter by RSVP status
      responses:
        "200":
          description: Paginated list of user's RSVPs
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedAttendeeResponse"
              examples:
                userRsvps:
                  summary: Example user RSVPs response
                  value:
                    attendees:
                      - id: "1"
                        userId: "user123"
                        eventId: "event456"
                        status: "going"
                        rsvpAt: "2025-11-20T10:30:00Z"
                        createdAt: "2025-11-20T10:30:00Z"
                        updatedAt: "2025-11-20T10:30:00Z"
                      - id: "2"
                        userId: "user123"
                        eventId: "event789"
                        status: "interested"
                        rsvpAt: "2025-11-19T15:45:00Z"
                        createdAt: "2025-11-19T15:45:00Z"
                        updatedAt: "2025-11-19T15:45:00Z"
                    pagination:
                      current_page: 1
                      page_size: 10
                      total_count: 2
                      total_pages: 1
                      has_next: false
                      has_previous: false
                      next_page: null
                      previous_page: null
                    filters:
                      status: "going"
                    sorting:
                      sort_by: "rsvpAt"
                      sort_order: "desc"
        "400":
          description: Bad request - Invalid query parameters or field selection
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "500":
          description: Internal server error
 
  /rsvps/{id}:
    get:
      tags: [Attendees]
      summary: Get RSVP by ID with optional field selection
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Attendee ID
        - name: fields
          in: query
          schema:
            type: string
          description: Comma-separated list of fields to return (e.g., "id,eventId,status")
          example: "id,eventId,status,rsvpAt"
      responses:
        "200":
          description: Attendee found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Attendee"
        "400":
          description: Bad request - Invalid field selection
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Attendee not found - Invalid attendee ID
        "500":
          description: Internal server error
 
  /events/{eventId}/attendees:
    get:
      tags: [Attendees]
      summary: List attendees for a specific event with advanced filtering, sorting, pagination, and field selection
      description: |
        Retrieve a paginated list of attendees for a specific event with support for:
        - **Pagination**: Use `page` and `page_size` parameters
        - **Sorting**: Use `sort_by` and `sort_order` parameters
        - **Filtering**: Filter by userId or status
        - **Field Selection**: Use `fields` parameter to specify which fields to return
      security:
        - bearerAuth: []
      parameters:
        - name: eventId
          in: path
          required: true
          schema:
            type: string
          description: Event ID to get attendees for
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number (starts from 1)
        - name: page_size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of attendees per page (max 100)
        - name: sort_by
          in: query
          schema:
            type: string
            enum: [id, userId, status, rsvpAt, createdAt, updatedAt]
            default: id
          description: Field to sort by
        - name: sort_order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order (ascending or descending)
        - name: fields
          in: query
          schema:
            type: string
          description: Comma-separated list of fields to return (e.g., "id,userId,status")
          example: "id,userId,status,rsvpAt"
        - name: userId
          in: query
          schema:
            type: string
          description: Filter by user ID (exact match)
        - name: status
          in: query
          schema:
            type: string
            enum: [invited, going, interested, not_going]
          description: Filter by RSVP status
      responses:
        "200":
          description: Paginated list of event attendees
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EventAttendeeResponse"
              examples:
                eventAttendees:
                  summary: Example event attendees response
                  value:
                    event_id: "event456"
                    attendees:
                      - id: "1"
                        userId: "user123"
                        eventId: "event456"
                        status: "going"
                        rsvpAt: "2025-11-20T10:30:00Z"
                        createdAt: "2025-11-20T10:30:00Z"
                        updatedAt: "2025-11-20T10:30:00Z"
                      - id: "2"
                        userId: "user456"
                        eventId: "event456"
                        status: "interested"
                        rsvpAt: "2025-11-19T15:45:00Z"
                        createdAt: "2025-11-19T15:45:00Z"
                        updatedAt: "2025-11-19T15:45:00Z"
                    pagination:
                      current_page: 1
                      page_size: 10
                      total_count: 15
                      total_pages: 2
                      has_next: true
                      has_previous: false
                      next_page: 2
                      previous_page: null
                    filters:
                      status: "going"
                    sorting:
                      sort_by: "rsvpAt"
                      sort_order: "desc"
        "400":
          description: Bad request - Invalid query parameters or field selection
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Event not found - Invalid event ID
        "422":
          description: Validation error - Invalid parameter values
        "500":
          description: Internal server error
 
  /events/{eventId}/rsvps:
    post:
      tags: [Attendees]
      summary: Create RSVP for an event
      description: |
        Create a new RSVP (attendance record) for the authenticated user and the specified event.
        RESTful sub-resource pattern: POST /events/123/rsvps?status=going
      security:
        - bearerAuth: []
      parameters:
        - name: eventId
          in: path
          required: true
          schema:
            type: string
          description: Event ID to RSVP for
        - name: status
          in: query
          required: true
          schema:
            type: string
            enum: [going, interested, not_going]
          description: RSVP status
          example: "going"
      responses:
        "201":
          description: RSVP created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Attendee"
        "400":
          description: Bad request - Invalid RSVP status, invalid event ID, or missing required fields
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Event not found - Invalid event ID
        "409":
          description: Conflict - RSVP already exists for this user and event
        "422":
          description: Validation error - Request body validation failed
        "500":
          description: Internal server error

    put:
      tags: [Attendees]
      summary: Update RSVP for an event
      description: |
        Update an existing RSVP status for the authenticated user and the specified event.
        RESTful sub-resource pattern: PUT /events/123/rsvps?status=interested
      security:
        - bearerAuth: []
      parameters:
        - name: eventId
          in: path
          required: true
          schema:
            type: string
          description: Event ID to update RSVP for
        - name: status
          in: query
          required: true
          schema:
            type: string
            enum: [going, interested, not_going]
          description: Updated RSVP status
          example: "interested"
      responses:
        "200":
          description: RSVP updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Attendee"
        "400":
          description: Bad request - Invalid RSVP status or missing required fields
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: RSVP not found - No existing RSVP found for this user and event
        "422":
          description: Validation error - Request body validation failed
        "500":
          description: Internal server error

  ##############################
  # VENDORS SERVICE
  ##############################
  /vendors:
    get:
      tags: [Vendors]
      summary: List vendors from global catalog
      description: |
        List vendors with advanced filtering, sorting, pagination, and field selection.
        **Note:** Vendors are global entities not tied to specific events.
        
        **Role-based results:**
        - **Admins**: Can view all vendors
        - **Organizers**: Can view all vendors (for task assignment)
        - **Vendors**: Can only view their own profile (auto-filtered by user_id)
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number (starts from 1)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: page_size
          in: query
          description: Number of vendors per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: sort_by
          in: query
          description: Field to sort by
          schema:
            type: string
            enum: [id, name, email, phone]
            default: id
        - name: sort_order
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: asc
        - name: fields
          in: query
          description: Comma-separated list of fields to return
          schema:
            type: string
            example: "id,name,email"
        - name: name
          in: query
          description: Filter by vendor name (partial match)
          schema:
            type: string
        - name: email
          in: query
          description: Filter by vendor email (partial match)
          schema:
            type: string
        - name: phone
          in: query
          description: Filter by vendor phone (partial match)
          schema:
            type: string
        - name: search
          in: query
          description: Global search across all text fields
          schema:
            type: string
      responses:
        "200":
          description: Paginated list of vendors
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedVendorResponse"
        "400":
          description: Bad request - Invalid query parameters
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "500":
          description: Internal server error

    post:
      tags: [Vendors]
      summary: Create vendor in global catalog
      description: |
        Manually create a new vendor in the global vendor catalog.
        
        **Note:** Vendors are typically auto-created when users register with role='vendor'.
        This endpoint is for admin use only (e.g., importing vendors, system management).
        
        **Permissions:** Admin only
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VendorCreate"
      responses:
        "201":
          description: Vendor created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Vendor"
        "400":
          description: Bad request - Invalid input data or missing required fields
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "409":
          description: Conflict - Vendor already exists with same email
        "422":
          description: Validation error - Request body validation failed
        "500":
          description: Internal server error

  /vendors/{id}:
    get:
      tags: [Vendors]
      summary: Get vendor by ID with optional field selection
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: fields
          in: query
          description: Comma-separated list of fields to return
          schema:
            type: string
            example: "id,name,email"
      responses:
        "200":
          description: Vendor found
          content:
            application/json:
              schema:
                type: object
        "400":
          description: Bad request - Invalid field selection
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Vendor not found - Invalid vendor ID
        "500":
          description: Internal server error

    patch:
      tags: [Vendors]
      summary: Update vendor information
      description: |
        Update vendor profile information.
        
        **Role-based access:**
        - **Vendors**: Can only update their own profile (matched by user_id). Cannot change email.
        - **Admins**: Can update any vendor profile including email (for system management).
        - **Organizers**: Cannot update vendors (vendors are independent entities).
        
        **Note**: Vendors should use their vendor ID (from GET /vendors/me) to update their profile.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Vendor ID to update
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VendorUpdate"
            examples:
              vendorSelfUpdate:
                summary: Vendor updating own profile (name and phone only)
                value:
                  name: "John's Premium Catering"
                  phone: "+1234567890"
              adminUpdate:
                summary: Admin updating vendor profile (full access)
                value:
                  name: "John's Catering"
                  email: "newemail@catering.com"
                  phone: "+1234567890"
      responses:
        "200":
          description: Updated vendor
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Vendor"
        "400":
          description: Bad request - Invalid input data or vendor trying to change email
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Vendor trying to update another vendor's profile
        "404":
          description: Vendor not found - Invalid vendor ID
        "409":
          description: Conflict - Email already exists for another vendor
        "422":
          description: Validation error - Request body validation failed
        "500":
          description: Internal server error

    delete:
      tags: [Vendors]
      summary: Delete vendor from global catalog
      description: |
        Delete a vendor from the global catalog.
        
        **Permissions:** Admin only
        
        **Warning:** This operation should be used carefully as it may affect historical data.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: Vendor deleted successfully
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Vendor not found - Invalid vendor ID
        "409":
          description: Conflict - Cannot delete vendor with existing dependencies
        "500":
          description: Internal server error

  ##############################
  # NOTIFICATIONS SERVICE
  ##############################
  /notifications:
    get:
      tags: [Notifications]
      summary: Get notifications for current user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of notifications
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Notification"
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "500":
          description: Internal server error
 
    post:
      tags: [Notifications]
      summary: Send a notification
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Notification"
      responses:
        "201":
          description: Notification sent
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Notification"
        "400":
          description: Bad request - Invalid notification data or missing required fields
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Recipient not found - Invalid recipient ID
        "422":
          description: Validation error - Request body validation failed
        "429":
          description: Too many requests - Notification rate limit exceeded
        "500":
          description: Internal server error

  ##############################
  # TASKS SERVICE
  ##############################
  /tasks:
    get:
      tags: [Tasks]
      summary: List all tasks
      description: |
        List all tasks with pagination, filtering, sorting, and field selection.
        **Note:** To create tasks, use POST /events/{eventId}/tasks instead.
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: page_size
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: sort_by
          in: query
          description: Field to sort by
          schema:
            type: string
            enum: [id, title, status, eventId, vendorId, organizerId, createdAt, updatedAt]
            default: id
        - name: sort_order
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: title
          in: query
          description: Filter by title (partial match, case-insensitive)
          schema:
            type: string
        - name: status
          in: query
          description: Filter by status
          schema:
            type: string
            enum: [pending, in_progress, completed]
        - name: event_id
          in: query
          description: Filter by event ID
          schema:
            type: integer
        - name: vendor_id
          in: query
          description: Filter by vendor ID
          schema:
            type: integer
        - name: organizer_id
          in: query
          description: Filter by organizer ID
          schema:
            type: integer
        - name: search
          in: query
          description: Search in title and description (partial match, case-insensitive)
          schema:
            type: string
        - name: fields
          in: query
          description: Comma-separated list of fields to return (e.g., "id,title,status")
          schema:
            type: string
          example: "id,title,status,eventId"
      responses:
        "200":
          description: Paginated list of tasks
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskPaginationResponse"
              examples:
                fullResponse:
                  summary: Full response with pagination
                  value:
                    data:
                      - id: "1"
                        title: "Setup venue"
                        description: "Arrange chairs and tables"
                        status: "pending"
                        eventId: "123"
                        vendorId: "456"
                        organizerId: "789"
                        createdAt: "2024-01-01T10:00:00Z"
                        updatedAt: "2024-01-01T10:00:00Z"
                    pagination:
                      current_page: 1
                      page_size: 10
                      total_count: 25
                      total_pages: 3
                      has_next: true
                      has_previous: false
                      next_page: 2
                      previous_page: null
                selectedFields:
                  summary: Response with field selection
                  value:
                    data:
                      - id: "1"
                        title: "Setup venue"
                        status: "pending"
                    pagination:
                      current_page: 1
                      page_size: 10
                      total_count: 25
                      total_pages: 3
                      has_next: true
                      has_previous: false
                      next_page: 2
                      previous_page: null
        "400":
          description: Bad request - Invalid query parameters
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "422":
          description: Validation error - Query parameters validation failed
        "500":
          description: Internal server error

  # Note: POST /tasks has been REMOVED - use POST /events/{eventId}/tasks instead

  /tasks/{id}:
    get:
      tags: [Tasks]
      summary: Get task by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Task found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Task not found - Invalid task ID
        "500":
          description: Internal server error
 
    patch:
      tags: [Tasks]
      summary: Update task
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateEventTask"
      responses:
        "200":
          description: Updated task
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        "400":
          description: Bad request - Invalid task data
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Task not found - Invalid task ID
        "409":
          description: Conflict - Task status transition not allowed
        "422":
          description: Validation error - Request body validation failed
        "500":
          description: Internal server error
 
    delete:
      tags: [Tasks]
      summary: Delete task
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Task deleted successfully
        "401":
          description: Unauthorized - JWT token missing or invalid
        "403":
          description: Forbidden - Valid token but insufficient permissions
        "404":
          description: Task not found - Invalid task ID
        "409":
          description: Conflict - Cannot delete task in progress or with dependencies
        "500":
          description: Internal server error
